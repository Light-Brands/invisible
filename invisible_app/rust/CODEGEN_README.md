# FFI Code Generation

This directory contains Rust FFI code that needs to be compiled and have Dart bindings generated.

## Generating Dart Bindings

The Dart FFI bindings are auto-generated by `flutter_rust_bridge_codegen`. To generate them:

```bash
cd invisible_app/rust
flutter_rust_bridge_codegen generate
```

This will create/update files in `invisible_app/lib/ffi/`:
- `api/auth.dart` - Authentication functions
- `api/wallet.dart` - Wallet functions
- `api/messaging.dart` - Messaging functions (NEW)
- `frb_generated.dart` - Generated bridge infrastructure

## Requirements

- Flutter SDK in PATH
- Rust toolchain (1.70+)
- flutter_rust_bridge_codegen CLI tool

## Module Status

### âœ… Completed FFI Modules

1. **Authentication** (`src/api/auth.rs`)
   - Argon2id PIN hashing
   - TOTP 2FA generation and verification

2. **Wallet** (`src/api/wallet.rs`)
   - BIP39 mnemonic generation
   - HD wallet address derivation (BTC, ETH, XMR, ZEC)

3. **Messaging** (`src/api/messaging.rs`) - STRUCTURE ONLY
   - Contact management
   - Message send/receive placeholders
   - Signal protocol integration pending

### ðŸš§ TODO: Full Implementation

**Messaging Module** requires:
- Connect to `invisible-messaging` crate for Signal protocol
- Implement X3DH key exchange
- Integrate Scrambler network routing
- Add relay node polling
- Secure storage for contacts and sessions

## Testing

After generating bindings:

```bash
cd invisible_app
flutter test
```

## Build Issues

If you see `Error: Dart/Flutter toolchain not available`:
- Ensure Flutter SDK is installed and in PATH
- Run `flutter doctor` to verify setup
- Check that `flutter_rust_bridge_codegen` is installed: `cargo install flutter_rust_bridge_codegen`
